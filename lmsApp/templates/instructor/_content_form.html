{% load crispy_forms_tags %}

<div class="p-6">
    <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
        <i class="fas fa-file-alt mr-3 text-indigo-600"></i> {{ page_title|default:"Content Details" }}
    </h3>
    <p class="text-gray-600 mb-6">Lesson: <span class="font-semibold">{{ lesson.title }}</span> (Module: {{ module.title }})</p>
    <form method="post" enctype="multipart/form-data" 
          action="{% if content.id %}
                      {% url 'content_update' course_slug=course.slug module_id=module.id lesson_id=lesson.id content_id=content.id %}
                  {% else %}
                      {% url 'content_create' course_slug=course.slug module_id=module.id lesson_id=lesson.id %}
                  {% endif %}" 
          class="space-y-4">
        {% csrf_token %}
        {{ form.media }}
        {{ form|crispy }}

        <div class="mt-6 flex justify-end space-x-3">
            <button type="button" onclick="closeModal()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">
                Cancel
            </button>
            <button type="submit" class="bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 transition duration-300 flex items-center justify-center shadow-md hover:shadow-lg">
                <i class="fas fa-save mr-2"></i> Save Content
            </button>
        </div>
    </form>
</div>

<script>
    // JavaScript to conditionally show/hide content fields based on content_type
    document.addEventListener('DOMContentLoaded', function() {
        const contentTypeSelect = document.getElementById('id_content_type');
        
        // Use more general selectors as Crispy forms might wrap labels and divs
        const fileField = document.getElementById('div_id_file');
        const textField = document.getElementById('div_id_text_content');
        const videoUrlField = document.getElementById('div_id_video_url');

        function toggleContentFields() {
            const selectedType = contentTypeSelect.value;

            // Hide all fields first
            if (fileField) fileField.style.display = 'none';
            if (textField) textField.style.display = 'none';
            if (videoUrlField) videoUrlField.style.display = 'none';

            // Show fields based on the selected type
            if (selectedType === 'video') {
                if (videoUrlField) videoUrlField.style.display = 'block';
                // Keeping file upload visible for video allows uploading local files instead of just a URL
                if (fileField) fileField.style.display = 'block'; 
            } else if (selectedType === 'pdf' || selectedType === 'slide') {
                if (fileField) fileField.style.display = 'block';
            } else if (selectedType === 'text') {
                if (textField) textField.style.display = 'block';
            }
        }

        // Add event listener and trigger initial state
        if (contentTypeSelect) {
            contentTypeSelect.addEventListener('change', toggleContentFields);
            toggleContentFields();
        }
    });
</script>